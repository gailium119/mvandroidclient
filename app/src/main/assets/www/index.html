<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="viewport" content="user-scalable=no">
        <title>Webview Client - fs/path 模块测试</title>
        <style>
            /* 自定义滚动条样式 */
            ::-webkit-scrollbar {
                width: 10px;
                height: 10px;
            }
            
            ::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 5px;
            }
            
            ::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 5px;
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
            
            /* 日志区域自定义滚动条 */
            #log::-webkit-scrollbar {
                width: 8px;
            }
            
            #log::-webkit-scrollbar-track {
                background: #e0e0e0;
            }
            
            #log::-webkit-scrollbar-thumb {
                background: #4CAF50;
                border-radius: 4px;
            }
            
            #log::-webkit-scrollbar-thumb:hover {
                background: #388E3C;
            }
            
            /* 确保滚动区域正确显示 */
            html, body {
                scrollbar-width: thin;
                scrollbar-color: #888 #f1f1f1;
                overflow: auto;
                margin: 0;
                padding: 0;
                height: 100%;
                font-family: Arial, sans-serif;
            }
            
            /* 移动端优化 */
            * {
                -webkit-overflow-scrolling: touch;
                box-sizing: border-box;
            }
            
            /* 页面容器 */
            .page-container {
                width: 100%;
                height: 100vh;
                overflow-y: auto;
                background-color: white;
            }
            
            /* 页面内容 */
            .page {
                display: none;
                padding: 20px;
                min-height: calc(100vh - 100px);
            }
            
            .page.active {
                display: block;
            }
            
            /* 导航栏 */
            .navbar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: #f8f9fa;
                border-top: 1px solid #dee2e6;
                padding: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                z-index: 1000;
            }
            
            .nav-buttons {
                display: flex;
                gap: 10px;
            }
            
            .nav-btn {
                background-color: #4CAF50;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: background-color 0.3s;
            }
            
            .nav-btn:hover {
                background-color: #45a049;
            }
            
            .nav-btn:disabled {
                background-color: #cccccc;
                cursor: not-allowed;
            }
            
            .page-indicator {
                font-weight: bold;
                color: #333;
                font-size: 14px;
            }
            
            /* 按钮样式 */
            .test-btn {
                background-color: #007bff;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                margin: 5px 0;
                font-size: 14px;
                transition: background-color 0.3s;
            }
            
            .test-btn:hover {
                background-color: #0056b3;
            }
            
            .test-btn.danger {
                background-color: #dc3545;
            }
            
            .test-btn.danger:hover {
                background-color: #c82333;
            }
            
            .test-btn.success {
                background-color: #28a745;
            }
            
            .test-btn.success:hover {
                background-color: #218838;
            }
            
            /* 测试区域样式 */
            .test-section {
                margin: 20px 0;
                padding: 15px;
                background-color: #f8f9fa;
                border-left: 4px solid #007bff;
                border-radius: 5px;
            }
            
            .test-result {
                margin-top: 10px;
                padding: 10px;
                border-radius: 5px;
                min-height: 30px;
            }
            
            /* 状态显示 */
            .status-box {
                padding: 15px;
                background-color: #e9ecef;
                border: 1px solid #ced4da;
                border-radius: 5px;
                margin-bottom: 20px;
                font-weight: bold;
            }
            
            /* 输入框样式 */
            .test-input {
                padding: 8px;
                border: 1px solid #ced4da;
                border-radius: 5px;
                width: 100%;
                max-width: 400px;
                margin: 5px 0;
            }
            
            /* 日志区域 */
            .log-container {
                height: 250px;
                overflow-y: auto;
                border: 1px solid #ced4da;
                border-radius: 5px;
                background-color: #f9f9f9;
                padding: 10px;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                margin-top: 10px;
            }
            
            .log-entry {
                margin-bottom: 5px;
                padding: 2px 0;
                border-bottom: 1px solid #eee;
            }
            
            .log-error { color: #dc3545; }
            .log-success { color: #28a745; }
            .log-warning { color: #ffc107; }
            .log-info { color: #17a2b8; }
            
            /* 页面标题 */
            .page-title {
                color: #333;
                border-bottom: 2px solid #4CAF50;
                padding-bottom: 10px;
                margin-top: 0;
            }
            
            /* 测试列表 */
            .test-list {
                list-style-type: none;
                padding: 0;
            }
            
            .test-list li {
                padding: 8px;
                border-bottom: 1px solid #eee;
                cursor: pointer;
                transition: background-color 0.3s;
            }
            
            .test-list li:hover {
                background-color: #f8f9fa;
            }
            
            /* 进度条 */
            .progress-container {
                height: 10px;
                background-color: #e9ecef;
                border-radius: 5px;
                margin: 20px 0;
                overflow: hidden;
            }
            
            .progress-bar {
                height: 100%;
                background-color: #4CAF50;
                width: 0%;
                transition: width 0.5s;
            }
        </style>
    </head>
    <body>
        <div class="page-container">
            <!-- 第1页：首页 -->
            <div id="page1" class="page active">
                <h1 class="page-title">Node.js 模块测试系统</h1>
                
                <div class="status-box" id="global-status">
                    系统状态: 正在初始化...
                </div>
                
                <div class="test-section">
                    <h3>欢迎使用 fs 和 path 模块测试系统</h3>
                    <p>本系统用于测试在 Android WebView 中实现的 Node.js 兼容模块。</p>
                    
                    <h4>测试模块:</h4>
                    <ul class="test-list">
                        <li><strong>fs 模块:</strong> 文件系统操作（同步/异步）</li>
                        <li><strong>path 模块:</strong> 路径操作和解析</li>
                    </ul>
                    
                    <h4>测试内容:</h4>
                    <ol>
                        <li>模块加载测试</li>
                        <li>path 模块功能测试</li>
                        <li>fs 模块文件操作测试</li>
                        <li>目录操作测试</li>
                        <li>错误处理测试</li>
                        <li>综合测试</li>
                    </ol>
                    
                    <h4>使用说明:</h4>
                    <p>点击下方导航按钮切换到不同的测试页面，或直接点击下方按钮开始全面测试:</p>
                    
                    <button class="test-btn success" onclick="runAllTests()">开始全面测试</button>
                    <button class="test-btn" onclick="checkEnvironment()">检查运行环境</button>
                </div>
                
                <div class="test-section">
                    <h3>系统信息</h3>
                    <div id="system-info">
                        正在获取系统信息...
                    </div>
                </div>
            </div>
            
            <!-- 第2页：模块加载测试 -->
            <div id="page2" class="page">
                <h1 class="page-title">模块加载测试</h1>
                
                <div class="test-section">
                    <h3>测试 require() 函数和模块加载</h3>
                    <p>测试 Node.js 风格的模块加载功能是否正常工作。</p>
                    
                    <button class="test-btn" onclick="testModuleLoading()">运行模块加载测试</button>
                    <button class="test-btn" onclick="checkInterfaces()">检查 JavaScript 接口</button>
                    
                    <div class="test-result" id="moduleTestResult">
                        等待测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>模块可用性检查</h3>
                    <div id="moduleAvailability">
                        <div>fs 模块: <span id="fs-status">未检查</span></div>
                        <div>path 模块: <span id="path-status">未检查</span></div>
                        <div>require 函数: <span id="require-status">未检查</span></div>
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>测试日志</h3>
                    <div class="log-container" id="page2-log"></div>
                </div>
            </div>
            
            <!-- 第3页：path 模块测试 -->
            <div id="page3" class="page">
                <h1 class="page-title">path 模块测试</h1>
                
                <div class="test-section">
                    <h3>路径操作测试</h3>
                    <p>测试 path 模块的各种路径操作功能。</p>
                    
                    <div style="margin-bottom: 10px;">
                        <label>测试路径: </label>
                        <input type="text" class="test-input" id="testPath" value="files/test.txt">
                    </div>
                    
                    <button class="test-btn" onclick="testPathModule()">运行 path 模块测试</button>
                    <button class="test-btn" onclick="testPathSpecific('join')">测试 join()</button>
                    <button class="test-btn" onclick="testPathSpecific('dirname')">测试 dirname()</button>
                    <button class="test-btn" onclick="testPathSpecific('basename')">测试 basename()</button>
                    
                    <div class="test-result" id="pathTestResult">
                        等待测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>测试结果</h3>
                    <div id="pathResults"></div>
                </div>
            </div>
            
            <!-- 第4页：fs 模块测试（同步） -->
            <div id="page4" class="page">
                <h1 class="page-title">fs 模块测试（同步）</h1>
                
                <div class="test-section">
                    <h3>同步文件操作测试</h3>
                    <p>测试 fs 模块的同步文件操作方法。</p>
                    
                    <div style="margin-bottom: 10px;">
                        <label>测试目录: </label>
                        <input type="text" class="test-input" id="testDir" value="files">
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <label>文件名: </label>
                        <input type="text" class="test-input" id="testFileName" value="test_sync.txt">
                    </div>
                    
                    <button class="test-btn" onclick="testFileOperations()">测试同步文件操作</button>
                    <button class="test-btn" onclick="testFileWrite()">测试文件写入</button>
                    <button class="test-btn" onclick="testFileRead()">测试文件读取</button>
                    <button class="test-btn" onclick="testFileExists()">测试文件存在性检查</button>
                    
                    <div class="test-result" id="fsTestResult">
                        等待测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>文件状态信息</h3>
                    <div id="fileStatus"></div>
                </div>
            </div>
            
            <!-- 第5页：fs 模块测试（异步） -->
            <div id="page5" class="page">
                <h1 class="page-title">fs 模块测试（异步）</h1>
                
                <div class="test-section">
                    <h3>异步文件操作测试</h3>
                    <p>测试 fs 模块的异步文件操作方法。</p>
                    
                    <div style="margin-bottom: 10px;">
                        <label>测试目录: </label>
                        <input type="text" class="test-input" id="asyncTestDir" value="files">
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <label>文件名: </label>
                        <input type="text" class="test-input" id="asyncFileName" value="test_async.txt">
                    </div>
                    
                    <button class="test-btn" onclick="testAsyncFileOperations()">测试异步文件操作</button>
                    <button class="test-btn" onclick="testAsyncWrite()">测试异步写入</button>
                    <button class="test-btn" onclick="testAsyncRead()">测试异步读取</button>
                    <button class="test-btn" onclick="testAsyncExists()">测试异步存在性检查</button>
                    
                    <div class="test-result" id="asyncTestResult">
                        等待测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>异步操作日志</h3>
                    <div class="log-container" id="asyncLog"></div>
                </div>
            </div>
            
            <!-- 第6页：目录操作测试 -->
            <div id="page6" class="page">
                <h1 class="page-title">目录操作测试</h1>
                
                <div class="test-section">
                    <h3>目录和文件系统操作</h3>
                    <p>测试目录创建、遍历、删除等操作。</p>
                    
                    <div style="margin-bottom: 10px;">
                        <label>基础目录: </label>
                        <input type="text" class="test-input" id="baseTestDir" value="files">
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <label>测试子目录: </label>
                        <input type="text" class="test-input" id="testSubDir" value="test_directory">
                    </div>
                    
                    <button class="test-btn" onclick="testDirectoryOperations()">测试目录操作</button>
                    <button class="test-btn" onclick="testMkdir()">测试创建目录</button>
                    <button class="test-btn" onclick="testReaddir()">测试读取目录</button>
                    <button class="test-btn" onclick="testStat()">测试文件状态</button>
                    <button class="test-btn danger" onclick="cleanTestDir()">清理测试目录</button>
                    
                    <div class="test-result" id="dirTestResult">
                        等待测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>目录内容</h3>
                    <div id="dirContents"></div>
                </div>
            </div>
            
            <!-- 第7页：错误处理测试 -->
            <div id="page7" class="page">
                <h1 class="page-title">错误处理测试</h1>
                
                <div class="test-section">
                    <h3>异常和错误处理测试</h3>
                    <p>测试模块在遇到错误时的处理能力。</p>
                    
                    <button class="test-btn danger" onclick="testErrorHandling()">测试错误处理</button>
                    <button class="test-btn" onclick="testNonexistentFile()">测试读取不存在的文件</button>
                    <button class="test-btn" onclick="testInvalidPath()">测试无效路径</button>
                    <button class="test-btn" onclick="testNonexistentModule()">测试不存在的模块</button>
                    
                    <div class="test-result" id="errorTestResult">
                        等待测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>错误日志</h3>
                    <div class="log-container" id="errorLog"></div>
                </div>
            </div>
            
            <!-- 第8页：综合测试 -->
            <div id="page8" class="page">
                <h1 class="page-title">综合测试</h1>
                
                <div class="test-section">
                    <h3>完整功能测试</h3>
                    <p>运行所有测试，检查模块的完整功能。</p>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="testProgress"></div>
                    </div>
                    
                    <button class="test-btn success" onclick="runAllTests()">开始全面测试</button>
                    <button class="test-btn" onclick="stopTests()">停止测试</button>
                    
                    <div class="test-result" id="allTestResult">
                        准备开始测试...
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>测试统计</h3>
                    <div id="testStats">
                        <div>总测试数: <span id="totalTests">0</span></div>
                        <div>通过: <span id="passedTests">0</span></div>
                        <div>失败: <span id="failedTests">0</span></div>
                        <div>成功率: <span id="successRate">0%</span></div>
                    </div>
                </div>
                
                <div class="test-section">
                    <h3>测试日志</h3>
                    <div class="log-container" id="fullLog"></div>
                </div>
            </div>
            
            <!-- 第9页：全局日志 -->
            <div id="page9" class="page">
                <h1 class="page-title">全局日志</h1>
                
                <div class="test-section">
                    <h3>所有测试日志</h3>
                    <p>显示所有测试的完整日志记录。</p>
                    
                    <button class="test-btn" onclick="clearAllLogs()">清除所有日志</button>
                    <button class="test-btn" onclick="exportLogs()">导出日志</button>
                    
                    <div class="log-container" id="globalLog"></div>
                </div>
            </div>
        </div>
        
        <!-- 导航栏 -->
        <div class="navbar">
            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn" onclick="prevPage()" disabled>上一页</button>
                <button class="nav-btn" id="nextBtn" onclick="nextPage()">下一页</button>
            </div>
            <div class="page-indicator">
                第 <span id="currentPage">1</span> 页 / 共 <span id="totalPages">9</span> 页
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="goToPage(1)">首页</button>
                <button class="nav-btn" onclick="goToPage(9)">日志</button>
            </div>
        </div>

        <script>
            // ================ 页面导航功能 ================
            let currentPage = 1;
            const totalPages = 9;
            
            function updateNavigation() {
                document.getElementById('currentPage').textContent = currentPage;
                document.getElementById('totalPages').textContent = totalPages;
                
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;
                
                // 更新页面显示
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(`page${currentPage}`).classList.add('active');
                
                // 保存当前页到本地存储
                localStorage.setItem('lastPage', currentPage);
                
                // 更新全局状态
                updateGlobalStatus(`当前在第 ${currentPage} 页`);
            }
            
            function nextPage() {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateNavigation();
                }
            }
            
            function prevPage() {
                if (currentPage > 1) {
                    currentPage--;
                    updateNavigation();
                }
            }
            
            function goToPage(pageNum) {
                if (pageNum >= 1 && pageNum <= totalPages) {
                    currentPage = pageNum;
                    updateNavigation();
                }
            }
            
            // ================ 全局日志系统 ================
            const allLogs = [];
            
            function log(message, type = 'info', page = 'global') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = {
                    timestamp,
                    message,
                    type,
                    page
                };
                
                allLogs.push(logEntry);
                
                // 添加到全局日志
                const globalLog = document.getElementById('globalLog');
                if (globalLog) {
                    const entry = document.createElement('div');
                    entry.className = `log-entry log-${type}`;
                    entry.textContent = `[${timestamp}] ${message}`;
                    globalLog.appendChild(entry);
                    globalLog.scrollTop = globalLog.scrollHeight;
                }
                
                // 添加到页面特定日志
                let pageLogId;
                switch(page) {
                    case 'page2': pageLogId = 'page2-log'; break;
                    case 'page5': pageLogId = 'asyncLog'; break;
                    case 'page7': pageLogId = 'errorLog'; break;
                    case 'page8': pageLogId = 'fullLog'; break;
                }
                
                if (pageLogId) {
                    const pageLog = document.getElementById(pageLogId);
                    if (pageLog) {
                        const entry = document.createElement('div');
                        entry.className = `log-entry log-${type}`;
                        entry.textContent = `[${timestamp}] ${message}`;
                        pageLog.appendChild(entry);
                        pageLog.scrollTop = pageLog.scrollHeight;
                    }
                }
                
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
            
            function clearAllLogs() {
                allLogs.length = 0;
                document.querySelectorAll('.log-container').forEach(container => {
                    container.innerHTML = '';
                });
                log('已清除所有日志', 'info');
            }
            
            function exportLogs() {
                const logText = allLogs.map(entry => 
                    `[${entry.timestamp}] [${entry.type.toUpperCase()}] ${entry.message}`
                ).join('\n');
                
                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `node-module-test-logs-${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log('日志已导出', 'success');
            }
            
            // ================ 全局状态管理 ================
            function updateGlobalStatus(message, isError = false) {
                const statusBox = document.getElementById('global-status');
                if (statusBox) {
                    statusBox.textContent = `系统状态: ${message}`;
                    statusBox.style.backgroundColor = isError ? '#f8d7da' : '#d4edda';
                    statusBox.style.color = isError ? '#721c24' : '#155724';
                    statusBox.style.borderColor = isError ? '#f5c6cb' : '#c3e6cb';
                }
            }
            
            // ================ 测试功能 ================
            let testRunning = false;
            let testResults = {
                total: 0,
                passed: 0,
                failed: 0
            };
            
            function updateTestStats() {
                document.getElementById('totalTests').textContent = testResults.total;
                document.getElementById('passedTests').textContent = testResults.passed;
                document.getElementById('failedTests').textContent = testResults.failed;
                
                const successRate = testResults.total > 0 ? 
                    Math.round((testResults.passed / testResults.total) * 100) : 0;
                document.getElementById('successRate').textContent = `${successRate}%`;
                
                // 更新进度条
                const progress = testResults.total > 0 ? 
                    (testResults.passed + testResults.failed) / testResults.total * 100 : 0;
                document.getElementById('testProgress').style.width = `${progress}%`;
            }
            
            function resetTestStats() {
                testResults = { total: 0, passed: 0, failed: 0 };
                updateTestStats();
            }
            
            function addTestResult(isSuccess) {
                testResults.total++;
                if (isSuccess) {
                    testResults.passed++;
                } else {
                    testResults.failed++;
                }
                updateTestStats();
            }
            
            // ================ 环境检查 ================
            function checkEnvironment() {
                log('检查运行环境...', 'info', 'page1');
                
                const systemInfo = document.getElementById('system-info');
                const interfaces = ['AndroidFS', 'require'];
                
                let html = '<div style="font-family: monospace; font-size: 12px;">';
                
                interfaces.forEach(iface => {
                    const exists = typeof window[iface] === 'function' || window[iface] !== undefined;
                    const status = exists ? '<span style="color: green">✓ 可用</span>' : '<span style="color: red">✗ 不可用</span>';
                    html += `<div>${iface}: ${status}</div>`;
                    
                    if (exists) {
                        log(`${iface}: 可用`, 'success', 'page1');
                    } else {
                        log(`${iface}: 不可用`, 'error', 'page1');
                    }
                });
                
                html += '</div>';
                systemInfo.innerHTML = html;
                
                updateGlobalStatus('环境检查完成');
            }
            
            // ================ 模块加载测试 ================
            function testModuleLoading() {
                log('开始测试模块加载...', 'info', 'page2');
                const resultDiv = document.getElementById('moduleTestResult');
                resultDiv.innerHTML = '测试中...';
                resultDiv.style.backgroundColor = '#fff3cd';
                
                try {
                    // 测试 require 函数是否存在
                    if (typeof require !== 'function') {
                        const error = 'require 函数不存在';
                        resultDiv.innerHTML = `❌ ${error}`;
                        resultDiv.style.backgroundColor = '#f8d7da';
                        log(error, 'error', 'page2');
                        addTestResult(false);
                        return;
                    }
                    
                    log('✓ require 函数存在', 'success', 'page2');
                    
                    // 测试 fs 模块加载
                    let fs;
                    try {
                        fs = require('fs');
                        log('✓ fs 模块加载成功', 'success', 'page2');
                        document.getElementById('fs-status').innerHTML = '<span style="color: green">✓ 可用</span>';
                    } catch (e) {
                        const error = `fs 模块加载失败: ${e.message}`;
                        resultDiv.innerHTML = `❌ ${error}`;
                        resultDiv.style.backgroundColor = '#f8d7da';
                        log(error, 'error', 'page2');
                        document.getElementById('fs-status').innerHTML = '<span style="color: red">✗ 不可用</span>';
                        addTestResult(false);
                        return;
                    }
                    
                    // 测试 path 模块加载
                    let path;
                    try {
                        path = require('path');
                        log('✓ path 模块加载成功', 'success', 'page2');
                        document.getElementById('path-status').innerHTML = '<span style="color: green">✓ 可用</span>';
                    } catch (e) {
                        const error = `path 模块加载失败: ${e.message}`;
                        resultDiv.innerHTML = `❌ ${error}`;
                        resultDiv.style.backgroundColor = '#f8d7da';
                        log(error, 'error', 'page2');
                        document.getElementById('path-status').innerHTML = '<span style="color: red">✗ 不可用</span>';
                        addTestResult(false);
                        return;
                    }
                    
                    document.getElementById('require-status').innerHTML = '<span style="color: green">✓ 可用</span>';
                    
                    resultDiv.innerHTML = '✅ 模块加载测试成功! require(), fs 和 path 模块都可用。';
                    resultDiv.style.backgroundColor = '#d4edda';
                    log('模块加载测试完成', 'success', 'page2');
                    addTestResult(true);
                    
                } catch (error) {
                    resultDiv.innerHTML = `❌ 模块加载测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                    log(`异常: ${error.message}`, 'error', 'page2');
                    addTestResult(false);
                }
            }
            
            function checkInterfaces() {
                log('检查 JavaScript 接口...', 'info', 'page2');
                
                const interfaces = [
                    { name: 'AndroidFS', check: () => typeof AndroidFS !== 'undefined' },
                    { name: 'AndroidFS.readFileSync', check: () => typeof AndroidFS !== 'undefined' && typeof AndroidFS.readFileSync === 'function' }
                ];
                
                let allAvailable = true;
                interfaces.forEach(iface => {
                    const available = iface.check();
                    const status = available ? '✓ 可用' : '✗ 不可用';
                    const color = available ? 'green' : 'red';
                    log(`${iface.name}: ${status}`, available ? 'success' : 'error', 'page2');
                    
                    if (!available) allAvailable = false;
                });
                
                const resultDiv = document.getElementById('moduleTestResult');
                if (allAvailable) {
                    resultDiv.innerHTML = '✅ 所有 JavaScript 接口都可用';
                    resultDiv.style.backgroundColor = '#d4edda';
                } else {
                    resultDiv.innerHTML = '❌ 部分 JavaScript 接口不可用';
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // ================ path 模块测试 ================
            function testPathModule() {
                log('开始测试 path 模块...', 'info', 'page3');
                const resultDiv = document.getElementById('pathTestResult');
                const resultsDiv = document.getElementById('pathResults');
                resultDiv.innerHTML = '测试中...';
                resultDiv.style.backgroundColor = '#fff3cd';
                resultsDiv.innerHTML = '';
                
                try {
                    const path = require('path');
                    const testPath = document.getElementById('testPath').value;
                    
                    const tests = [
                        { name: 'join', test: () => path.join('/data', 'app', 'files', 'test.txt') },
                        { name: 'dirname', test: () => path.dirname(testPath) },
                        { name: 'basename', test: () => path.basename(testPath) },
                        { name: 'basename (with ext)', test: () => path.basename(testPath, '.txt') },
                        { name: 'extname', test: () => path.extname(testPath) },
                        { name: 'resolve', test: () => path.resolve('test.txt') }
                    ];
                    
                    let html = '<div style="font-family: monospace; font-size: 12px;">';
                    let allPassed = true;
                    
                    tests.forEach(test => {
                        try {
                            const result = test.test();
                            html += `<div>${test.name}: <span style="color: green">"${result}"</span></div>`;
                            log(`✓ ${test.name}: "${result}"`, 'success', 'page3');
                        } catch (error) {
                            html += `<div>${test.name}: <span style="color: red">失败 - ${error.message}</span></div>`;
                            log(`❌ ${test.name} 失败: ${error.message}`, 'error', 'page3');
                            allPassed = false;
                        }
                    });
                    
                    html += '</div>';
                    resultsDiv.innerHTML = html;
                    
                    if (allPassed) {
                        resultDiv.innerHTML = '✅ path 模块测试成功! 所有功能正常。';
                        resultDiv.style.backgroundColor = '#d4edda';
                        addTestResult(true);
                    } else {
                        resultDiv.innerHTML = '❌ path 模块测试有失败项';
                        resultDiv.style.backgroundColor = '#f8d7da';
                        addTestResult(false);
                    }
                    
                } catch (error) {
                    resultDiv.innerHTML = `❌ path 模块测试失败: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                    log(`错误: ${error.message}`, 'error', 'page3');
                    addTestResult(false);
                }
            }
            
            function testPathSpecific(method) {
                log(`测试 path.${method}()...`, 'info', 'page3');
                
                try {
                    const path = require('path');
                    const testPath = document.getElementById('testPath').value;
                    
                    let result;
                    switch(method) {
                        case 'join':
                            result = path.join('/data', 'app', testPath);
                            break;
                        case 'dirname':
                            result = path.dirname(testPath);
                            break;
                        case 'basename':
                            result = path.basename(testPath);
                            break;
                        default:
                            result = path[method](testPath);
                    }
                    
                    const resultsDiv = document.getElementById('pathResults');
                    resultsDiv.innerHTML = `<div style="font-family: monospace;">
                        path.${method}("${testPath}") = <span style="color: green">"${result}"</span>
                    </div>`;
                    
                    log(`path.${method}() 测试成功: "${result}"`, 'success', 'page3');
                    
                } catch (error) {
                    log(`path.${method}() 测试失败: ${error.message}`, 'error', 'page3');
                }
            }
            
            // ================ fs 模块测试（同步） ================
            function testFileOperations() {
                log('开始测试 fs 文件操作...', 'info', 'page4');
                const resultDiv = document.getElementById('fsTestResult');
                resultDiv.innerHTML = '测试中...';
                resultDiv.style.backgroundColor = '#fff3cd';
                
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('testDir').value;
                    const fileName = document.getElementById('testFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    const testContent = `这是测试文件内容\n生成时间: ${new Date().toISOString()}\n测试 fs 模块同步操作`;
                    
                    log(`测试目录: ${testDir}`, 'info', 'page4');
                    log(`测试文件: ${testFilePath}`, 'info', 'page4');
                    
                    // 确保目录存在
                    if (!fs.existsSync(testDir)) {
                        fs.mkdirSync(testDir, { recursive: true });
                        log(`✓ 创建目录: ${testDir}`, 'success', 'page4');
                    }
                    
                    // 写入文件
                    fs.writeFileSync(testFilePath, testContent, 'utf-8');
                    log(`✓ 文件写入成功`, 'success', 'page4');
                    
                    // 检查文件是否存在
                    const fileExists = fs.existsSync(testFilePath);
                    if (!fileExists) {
                        throw new Error('文件写入后检查不存在');
                    }
                    log(`✓ 文件存在检查: ${fileExists}`, 'success', 'page4');
                    
                    // 读取文件
                    const readContent = fs.readFileSync(testFilePath, 'utf-8');
                    log(`✓ 文件读取成功，长度: ${readContent.length} 字符`, 'success', 'page4');
                    
                    // 验证内容
                    const contentMatch = readContent === testContent;
                    log(`✓ 文件内容验证: ${contentMatch ? '通过' : '不匹配'}`, 
                        contentMatch ? 'success' : 'warning', 'page4');
                    
                    // 获取文件信息
                    const stats = fs.statSync(testFilePath);
                    const fileStatusDiv = document.getElementById('fileStatus');
                    fileStatusDiv.innerHTML = `
                        <div style="font-family: monospace;">
                            <div>文件路径: ${testFilePath}</div>
                            <div>文件大小: ${stats.size} 字节</div>
                            <div>是否是文件: ${stats.isFile()}</div>
                            <div>是否是目录: ${stats.isDirectory()}</div>
                            <div>修改时间: ${new Date(stats.mtime).toLocaleString()}</div>
                        </div>
                    `;
                    
                    log(`✓ 文件信息: 大小=${stats.size} 字节`, 'success', 'page4');
                    
                    resultDiv.innerHTML = `✅ fs 文件操作测试成功!<br>
                        文件: ${testFilePath}<br>
                        大小: ${stats.size} 字节<br>
                        内容验证: ${contentMatch ? '通过' : '部分通过'}`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    addTestResult(true);
                    
                } catch (error) {
                    resultDiv.innerHTML = `❌ fs 文件操作测试失败: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                    log(`错误: ${error.message}`, 'error', 'page4');
                    addTestResult(false);
                }
            }
            
            function testFileWrite() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('testDir').value;
                    const fileName = document.getElementById('testFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    const testContent = `测试写入时间: ${new Date().toLocaleString()}`;
                    
                    fs.writeFileSync(testFilePath, testContent, 'utf-8');
                    log(`文件写入成功: ${testFilePath}`, 'success', 'page4');
                    
                    const resultDiv = document.getElementById('fsTestResult');
                    resultDiv.innerHTML = `✅ 文件写入成功<br>路径: ${testFilePath}`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    
                } catch (error) {
                    log(`文件写入失败: ${error.message}`, 'error', 'page4');
                }
            }
            
            function testFileRead() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('testDir').value;
                    const fileName = document.getElementById('testFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    
                    if (!fs.existsSync(testFilePath)) {
                        log('文件不存在，请先创建文件', 'warning', 'page4');
                        return;
                    }
                    
                    const content = fs.readFileSync(testFilePath, 'utf-8');
                    log(`文件读取成功，内容: "${content.substring(0, 50)}${content.length > 50 ? '...' : ''}"`, 'success', 'page4');
                    
                    const resultDiv = document.getElementById('fsTestResult');
                    resultDiv.innerHTML = `✅ 文件读取成功<br>长度: ${content.length} 字符<br>内容预览: ${content.substring(0, 50)}${content.length > 50 ? '...' : ''}`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    
                } catch (error) {
                    log(`文件读取失败: ${error.message}`, 'error', 'page4');
                }
            }
            
            function testFileExists() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('testDir').value;
                    const fileName = document.getElementById('testFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    
                    const exists = fs.existsSync(testFilePath);
                    log(`文件存在检查: ${testFilePath} - ${exists ? '存在' : '不存在'}`, 
                        exists ? 'success' : 'warning', 'page4');
                    
                    const resultDiv = document.getElementById('fsTestResult');
                    resultDiv.innerHTML = `文件检查结果: ${exists ? '✅ 文件存在' : '⚠️ 文件不存在'}`;
                    resultDiv.style.backgroundColor = exists ? '#d4edda' : '#fff3cd';
                    
                } catch (error) {
                    log(`文件存在检查失败: ${error.message}`, 'error', 'page4');
                }
            }
            
            // ================ fs 模块测试（异步） ================
            function testAsyncFileOperations() {
                log('开始测试异步文件操作...', 'info', 'page5');
                const resultDiv = document.getElementById('asyncTestResult');
                resultDiv.innerHTML = '测试中...';
                resultDiv.style.backgroundColor = '#fff3cd';
                
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('asyncTestDir').value;
                    const fileName = document.getElementById('asyncFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    const testContent = `异步测试文件内容\n生成时间: ${new Date().toISOString()}`;
                    
                    log(`异步测试文件: ${testFilePath}`, 'info', 'page5');
                    
                    // 测试异步写入
                    fs.writeFile(testFilePath, testContent, 'utf-8', function(writeErr) {
                        if (writeErr) {
                            resultDiv.innerHTML = `❌ 异步写入失败: ${writeErr.message}`;
                            resultDiv.style.backgroundColor = '#f8d7da';
                            log(`异步写入失败: ${writeErr.message}`, 'error', 'page5');
                            addTestResult(false);
                            return;
                        }
                        
                        log('✓ 异步写入成功', 'success', 'page5');
                        
                        // 测试异步读取
                        fs.readFile(testFilePath, 'utf-8', function(readErr, data) {
                            if (readErr) {
                                resultDiv.innerHTML = `❌ 异步读取失败: ${readErr.message}`;
                                resultDiv.style.backgroundColor = '#f8d7da';
                                log(`异步读取失败: ${readErr.message}`, 'error', 'page5');
                                addTestResult(false);
                                return;
                            }
                            
                            log(`✓ 异步读取成功，长度: ${data.length} 字符`, 'success', 'page5');
                            
                            // 测试异步检查文件是否存在
                            fs.exists(testFilePath, function(exists) {
                                if (exists) {
                                    resultDiv.innerHTML = `✅ 异步文件操作测试成功!<br>
                                        文件: ${testFilePath}<br>
                                        内容长度: ${data.length} 字符<br>
                                        文件存在检查: 通过`;
                                    resultDiv.style.backgroundColor = '#d4edda';
                                    log('✓ 异步检查文件存在', 'success', 'page5');
                                    addTestResult(true);
                                } else {
                                    resultDiv.innerHTML = '❌ 异步检查文件不存在';
                                    resultDiv.style.backgroundColor = '#f8d7da';
                                    log('错误: 异步检查文件不存在', 'error', 'page5');
                                    addTestResult(false);
                                }
                            });
                        });
                    });
                    
                } catch (error) {
                    resultDiv.innerHTML = `❌ 异步文件操作测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                    log(`异常: ${error.message}`, 'error', 'page5');
                    addTestResult(false);
                }
            }
            
            // ================ fs 模块测试（异步）的其他函数 ================
            
            // 测试异步写入文件
            function testAsyncWrite() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('asyncTestDir').value;
                    const fileName = document.getElementById('asyncFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    const testContent = `异步写入测试\n时间: ${new Date().toLocaleString()}\n这是一个异步写入测试文件`;
                    
                    log(`开始异步写入文件: ${testFilePath}`, 'info', 'page5');
                    
                    fs.writeFile(testFilePath, testContent, 'utf-8', function(err) {
                        if (err) {
                            log(`❌ 异步写入失败: ${err.message}`, 'error', 'page5');
                            const resultDiv = document.getElementById('asyncTestResult');
                            resultDiv.innerHTML = `❌ 异步写入失败: ${err.message}`;
                            resultDiv.style.backgroundColor = '#f8d7da';
                        } else {
                            log(`✅ 异步写入成功: ${testFilePath}`, 'success', 'page5');
                            
                            // 验证文件是否创建成功
                            fs.readFile(testFilePath, 'utf-8', function(readErr, data) {
                                if (readErr) {
                                    log(`❌ 写入后读取验证失败: ${readErr.message}`, 'error', 'page5');
                                    const resultDiv = document.getElementById('asyncTestResult');
                                    resultDiv.innerHTML = `⚠️ 异步写入成功但验证失败: ${readErr.message}`;
                                    resultDiv.style.backgroundColor = '#fff3cd';
                                } else if (data === testContent) {
                                    log(`✅ 异步写入验证成功，内容一致`, 'success', 'page5');
                                    const resultDiv = document.getElementById('asyncTestResult');
                                    resultDiv.innerHTML = `✅ 异步写入成功!<br>文件: ${testFilePath}<br>大小: ${data.length} 字符<br>验证: 内容一致`;
                                    resultDiv.style.backgroundColor = '#d4edda';
                                } else {
                                    log(`⚠️ 异步写入验证: 内容不一致`, 'warning', 'page5');
                                    const resultDiv = document.getElementById('asyncTestResult');
                                    resultDiv.innerHTML = `⚠️ 异步写入成功但内容不一致<br>文件: ${testFilePath}<br>期望长度: ${testContent.length}<br>实际长度: ${data.length}`;
                                    resultDiv.style.backgroundColor = '#fff3cd';
                                }
                            });
                        }
                    });
                    
                } catch (error) {
                    log(`❌ 异步写入测试异常: ${error.message}`, 'error', 'page5');
                    const resultDiv = document.getElementById('asyncTestResult');
                    resultDiv.innerHTML = `❌ 异步写入测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 测试异步读取文件
            function testAsyncRead() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('asyncTestDir').value;
                    const fileName = document.getElementById('asyncFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    
                    log(`开始异步读取文件: ${testFilePath}`, 'info', 'page5');
                    
                    // 首先检查文件是否存在
                    fs.exists(testFilePath, function(exists) {
                        if (!exists) {
                            log(`⚠️ 文件不存在，先创建测试文件`, 'warning', 'page5');
                            
                            // 创建测试文件
                            const testContent = `异步读取测试文件\n创建时间: ${new Date().toLocaleString()}\n用于测试异步读取功能`;
                            
                            fs.writeFile(testFilePath, testContent, 'utf-8', function(writeErr) {
                                if (writeErr) {
                                    log(`❌ 创建测试文件失败: ${writeErr.message}`, 'error', 'page5');
                                    const resultDiv = document.getElementById('asyncTestResult');
                                    resultDiv.innerHTML = `❌ 创建测试文件失败: ${writeErr.message}`;
                                    resultDiv.style.backgroundColor = '#f8d7da';
                                    return;
                                }
                                
                                log(`✅ 测试文件创建成功，开始读取`, 'success', 'page5');
                                performAsyncRead(testFilePath);
                            });
                        } else {
                            performAsyncRead(testFilePath);
                        }
                    });
                    
                    function performAsyncRead(filePath) {
                        fs.readFile(filePath, 'utf-8', function(err, data) {
                            if (err) {
                                log(`❌ 异步读取失败: ${err.message}`, 'error', 'page5');
                                const resultDiv = document.getElementById('asyncTestResult');
                                resultDiv.innerHTML = `❌ 异步读取失败: ${err.message}`;
                                resultDiv.style.backgroundColor = '#f8d7da';
                            } else {
                                log(`✅ 异步读取成功，长度: ${data.length} 字符`, 'success', 'page5');
                                log(`文件内容预览: ${data.substring(0, 100)}${data.length > 100 ? '...' : ''}`, 'info', 'page5');
                                
                                const resultDiv = document.getElementById('asyncTestResult');
                                resultDiv.innerHTML = `✅ 异步读取成功!<br>文件: ${filePath}<br>长度: ${data.length} 字符<br>内容预览: ${data.substring(0, 50)}${data.length > 50 ? '...' : ''}`;
                                resultDiv.style.backgroundColor = '#d4edda';
                            }
                        });
                    }
                    
                } catch (error) {
                    log(`❌ 异步读取测试异常: ${error.message}`, 'error', 'page5');
                    const resultDiv = document.getElementById('asyncTestResult');
                    resultDiv.innerHTML = `❌ 异步读取测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 测试异步检查文件是否存在
            function testAsyncExists() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const testDir = document.getElementById('asyncTestDir').value;
                    const fileName = document.getElementById('asyncFileName').value;
                    const testFilePath = path.join(testDir, fileName);
                    
                    log(`开始异步检查文件是否存在: ${testFilePath}`, 'info', 'page5');
                    
                    // 测试异步 exists 函数
                    fs.exists(testFilePath, function(exists) {
                        const existsText = exists ? '存在' : '不存在';
                        const logType = exists ? 'success' : 'warning';
                        const color = exists ? 'green' : 'orange';
                        
                        log(`✅ 异步检查完成: 文件${existsText}`, logType, 'page5');
                        
                        const resultDiv = document.getElementById('asyncTestResult');
                        resultDiv.innerHTML = `文件检查结果: <span style="color: ${color}">${existsText}</span><br>路径: ${testFilePath}`;
                        resultDiv.style.backgroundColor = exists ? '#d4edda' : '#fff3cd';
                        
                        // 如果是存在的文件，可以进一步获取文件信息
                        if (exists) {
                            fs.stat(testFilePath, function(statErr, stats) {
                                if (!statErr && stats) {
                                    log(`文件详细信息: 大小=${stats.size}字节, 是否为文件=${stats.isFile()}, 是否为目录=${stats.isDirectory()}`, 'info', 'page5');
                                    resultDiv.innerHTML += `<br>文件大小: ${stats.size} 字节<br>是否为文件: ${stats.isFile() ? '是' : '否'}<br>是否为目录: ${stats.isDirectory() ? '是' : '否'}`;
                                }
                            });
                        }
                    });
                    
                } catch (error) {
                    log(`❌ 异步检查测试异常: ${error.message}`, 'error', 'page5');
                    const resultDiv = document.getElementById('asyncTestResult');
                    resultDiv.innerHTML = `❌ 异步检查测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // ================ 目录操作测试的其他函数 ================
            
            // 测试创建目录
            function testMkdir() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const baseDir = document.getElementById('baseTestDir').value;
                    const subDirName = document.getElementById('testSubDir').value;
                    const testSubDir = path.join(baseDir, subDirName);
                    const timestamp = Date.now();
                    const uniqueSubDir = path.join(baseDir, `${subDirName}_${timestamp}`);
                    
                    log(`开始测试创建目录: ${uniqueSubDir}`, 'info', 'page6');
                    
                    // 首先检查目录是否存在
                    if (fs.existsSync(testSubDir)) {
                        log(`⚠️ 测试目录已存在: ${testSubDir}`, 'warning', 'page6');
                    }
                    
                    // 使用异步方式创建目录
                    fs.mkdir(uniqueSubDir, { recursive: true }, function(err) {
                        if (err) {
                            log(`❌ 异步创建目录失败: ${err.message}`, 'error', 'page6');
                            const resultDiv = document.getElementById('dirTestResult');
                            resultDiv.innerHTML = `❌ 异步创建目录失败: ${err.message}`;
                            resultDiv.style.backgroundColor = '#f8d7da';
                        } else {
                            log(`✅ 异步创建目录成功: ${uniqueSubDir}`, 'success', 'page6');
                            
                            // 验证目录是否创建成功
                            fs.exists(uniqueSubDir, function(exists) {
                                if (exists) {
                                    fs.stat(uniqueSubDir, function(statErr, stats) {
                                        if (!statErr && stats && stats.isDirectory()) {
                                            log(`✅ 目录验证成功: 目录存在且是目录类型`, 'success', 'page6');
                                            
                                            const resultDiv = document.getElementById('dirTestResult');
                                            resultDiv.innerHTML = `✅ 创建目录成功!<br>路径: ${uniqueSubDir}<br>创建时间: ${new Date().toLocaleString()}<br>验证: 目录存在且类型正确`;
                                            resultDiv.style.backgroundColor = '#d4edda';
                                            
                                            // 更新目录内容显示
                                            updateDirContents(baseDir);
                                        } else {
                                            log(`⚠️ 目录验证: 不是目录类型或获取信息失败`, 'warning', 'page6');
                                            const resultDiv = document.getElementById('dirTestResult');
                                            resultDiv.innerHTML = `⚠️ 目录创建但验证失败<br>路径: ${uniqueSubDir}`;
                                            resultDiv.style.backgroundColor = '#fff3cd';
                                        }
                                    });
                                } else {
                                    log(`❌ 目录验证失败: 目录不存在`, 'error', 'page6');
                                    const resultDiv = document.getElementById('dirTestResult');
                                    resultDiv.innerHTML = `❌ 目录验证失败: 创建后目录不存在`;
                                    resultDiv.style.backgroundColor = '#f8d7da';
                                }
                            });
                        }
                    });
                    
                } catch (error) {
                    log(`❌ 创建目录测试异常: ${error.message}`, 'error', 'page6');
                    const resultDiv = document.getElementById('dirTestResult');
                    resultDiv.innerHTML = `❌ 创建目录测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 测试读取目录
            function testReaddir() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const baseDir = document.getElementById('baseTestDir').value;
                    
                    log(`开始测试读取目录: ${baseDir}`, 'info', 'page6');
                    
                    // 首先检查目录是否存在
                    fs.exists(baseDir, function(exists) {
                        if (!exists) {
                            log(`❌ 目录不存在: ${baseDir}`, 'error', 'page6');
                            const resultDiv = document.getElementById('dirTestResult');
                            resultDiv.innerHTML = `❌ 目录不存在: ${baseDir}`;
                            resultDiv.style.backgroundColor = '#f8d7da';
                            return;
                        }
                        
                        // 异步读取目录
                        fs.readdir(baseDir, function(err, files) {
                            if (err) {
                                log(`❌ 异步读取目录失败: ${err.message}`, 'error', 'page6');
                                const resultDiv = document.getElementById('dirTestResult');
                                resultDiv.innerHTML = `❌ 异步读取目录失败: ${err.message}`;
                                resultDiv.style.backgroundColor = '#f8d7da';
                            } else {
                                log(`✅ 异步读取目录成功，找到 ${files.length} 个项目`, 'success', 'page6');
                                
                                // 显示文件/目录详细信息
                                let fileDetails = [];
                                let processedCount = 0;
                                
                                if (files.length === 0) {
                                    displayResults(files, []);
                                    return;
                                }
                                
                                files.forEach(function(file, index) {
                                    const fullPath = path.join(baseDir, file);
                                    fs.stat(fullPath, function(statErr, stats) {
                                        if (!statErr && stats) {
                                            fileDetails.push({
                                                name: file,
                                                isFile: stats.isFile(),
                                                isDirectory: stats.isDirectory(),
                                                size: stats.size,
                                                mtime: new Date(stats.mtime).toLocaleString()
                                            });
                                        } else {
                                            fileDetails.push({
                                                name: file,
                                                isFile: false,
                                                isDirectory: false,
                                                size: 0,
                                                mtime: '未知'
                                            });
                                        }
                                        
                                        processedCount++;
                                        if (processedCount === files.length) {
                                            displayResults(files, fileDetails);
                                        }
                                    });
                                });
                            }
                        });
                    });
                    
                    function displayResults(files, fileDetails) {
                        const dirContentsDiv = document.getElementById('dirContents');
                        let html = `<div style="font-family: monospace; font-size: 12px;">`;
                        html += `<div>目录: ${baseDir}</div>`;
                        html += `<div>项目数量: ${files.length}</div>`;
                        html += `<div>项目列表:</div>`;
                        html += `<ul>`;
                        
                        if (fileDetails.length > 0) {
                            fileDetails.forEach(function(item) {
                                const type = item.isFile ? '📄 文件' : (item.isDirectory ? '📁 目录' : '❓ 未知');
                                const size = item.isFile ? ` (${item.size} 字节)` : '';
                                html += `<li>${type}: ${item.name}${size}</li>`;
                            });
                        } else {
                            html += `<li>空目录</li>`;
                        }
                        
                        html += `</ul>`;
                        html += `</div>`;
                        
                        dirContentsDiv.innerHTML = html;
                        
                        const resultDiv = document.getElementById('dirTestResult');
                        resultDiv.innerHTML = `✅ 目录读取成功!<br>目录: ${baseDir}<br>项目数量: ${files.length}`;
                        resultDiv.style.backgroundColor = '#d4edda';
                    }
                    
                } catch (error) {
                    log(`❌ 读取目录测试异常: ${error.message}`, 'error', 'page6');
                    const resultDiv = document.getElementById('dirTestResult');
                    resultDiv.innerHTML = `❌ 读取目录测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 更新目录内容显示
            function updateDirContents(dirPath) {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    if (!fs.existsSync(dirPath)) {
                        document.getElementById('dirContents').innerHTML = `<div>目录不存在: ${dirPath}</div>`;
                        return;
                    }
                    
                    const files = fs.readdirSync(dirPath);
                    let html = `<div style="font-family: monospace; font-size: 12px;">`;
                    html += `<div>目录: ${dirPath}</div>`;
                    html += `<div>项目数量: ${files.length}</div>`;
                    html += `<div>项目列表:</div>`;
                    html += `<ul>`;
                    
                    if (files.length > 0) {
                        files.forEach(function(file) {
                            const fullPath = path.join(dirPath, file);
                            const stats = fs.statSync(fullPath);
                            const type = stats.isFile() ? '📄 文件' : '📁 目录';
                            const size = stats.isFile() ? ` (${stats.size} 字节)` : '';
                            html += `<li>${type}: ${file}${size}</li>`;
                        });
                    } else {
                        html += `<li>空目录</li>`;
                    }
                    
                    html += `</ul>`;
                    html += `</div>`;
                    
                    document.getElementById('dirContents').innerHTML = html;
                    
                } catch (error) {
                    document.getElementById('dirContents').innerHTML = `<div>获取目录内容失败: ${error.message}</div>`;
                }
            }
            
            // 测试文件状态信息
            function testStat() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const baseDir = document.getElementById('baseTestDir').value;
                    const testFile = path.join(baseDir, 'stat_test.txt');
                    
                    log(`开始测试文件状态信息: ${testFile}`, 'info', 'page6');
                    
                    // 首先确保测试文件存在
                    fs.exists(testFile, function(exists) {
                        if (!exists) {
                            // 创建测试文件
                            const testContent = `状态测试文件\n创建时间: ${new Date().toLocaleString()}\n用于测试stat()函数`;
                            
                            fs.writeFile(testFile, testContent, 'utf-8', function(writeErr) {
                                if (writeErr) {
                                    log(`❌ 创建测试文件失败: ${writeErr.message}`, 'error', 'page6');
                                    const resultDiv = document.getElementById('dirTestResult');
                                    resultDiv.innerHTML = `❌ 创建测试文件失败: ${writeErr.message}`;
                                    resultDiv.style.backgroundColor = '#f8d7da';
                                    return;
                                }
                                
                                log(`✅ 测试文件创建成功，开始获取状态信息`, 'success', 'page6');
                                performStatTest(testFile);
                            });
                        } else {
                            performStatTest(testFile);
                        }
                    });
                    
                    function performStatTest(filePath) {
                        // 异步获取文件状态
                        fs.stat(filePath, function(err, stats) {
                            if (err) {
                                log(`❌ 异步获取文件状态失败: ${err.message}`, 'error', 'page6');
                                const resultDiv = document.getElementById('dirTestResult');
                                resultDiv.innerHTML = `❌ 异步获取文件状态失败: ${err.message}`;
                                resultDiv.style.backgroundColor = '#f8d7da';
                            } else {
                                log(`✅ 异步获取文件状态成功`, 'success', 'page6');
                                
                                const dirContentsDiv = document.getElementById('dirContents');
                                const html = `
                                    <div style="font-family: monospace; font-size: 12px;">
                                        <div>文件状态信息:</div>
                                        <div>文件路径: ${filePath}</div>
                                        <div>文件大小: ${stats.size} 字节</div>
                                        <div>是否为文件: ${stats.isFile() ? '是' : '否'}</div>
                                        <div>是否为目录: ${stats.isDirectory() ? '是' : '否'}</div>
                                        <div>是否为符号链接: ${stats.isSymbolicLink ? stats.isSymbolicLink() : '不支持'}</div>
                                        <div>创建时间: ${new Date(stats.birthtime || stats.mtime).toLocaleString()}</div>
                                        <div>修改时间: ${new Date(stats.mtime).toLocaleString()}</div>
                                        <div>访问时间: ${new Date(stats.atime).toLocaleString()}</div>
                                        <div>权限模式: ${stats.mode ? stats.mode.toString(8) : '未知'}</div>
                                    </div>
                                `;
                                
                                dirContentsDiv.innerHTML = html;
                                
                                const resultDiv = document.getElementById('dirTestResult');
                                resultDiv.innerHTML = `✅ 文件状态信息获取成功!<br>文件: ${filePath}<br>大小: ${stats.size} 字节<br>类型: ${stats.isFile() ? '文件' : (stats.isDirectory() ? '目录' : '其他')}`;
                                resultDiv.style.backgroundColor = '#d4edda';
                            }
                        });
                    }
                    
                } catch (error) {
                    log(`❌ 文件状态测试异常: ${error.message}`, 'error', 'page6');
                    const resultDiv = document.getElementById('dirTestResult');
                    resultDiv.innerHTML = `❌ 文件状态测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 清理测试目录
            function cleanTestDir() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const baseDir = document.getElementById('baseTestDir').value;
                    const subDirName = document.getElementById('testSubDir').value;
                    const testSubDir = path.join(baseDir, subDirName);
                    
                    log(`开始清理测试目录: ${testSubDir}`, 'info', 'page6');
                    
                    // 首先检查目录是否存在
                    if (!fs.existsSync(testSubDir)) {
                        log(`✅ 测试目录不存在，无需清理`, 'success', 'page6');
                        const resultDiv = document.getElementById('dirTestResult');
                        resultDiv.innerHTML = `✅ 测试目录不存在，无需清理<br>目录: ${testSubDir}`;
                        resultDiv.style.backgroundColor = '#d4edda';
                        updateDirContents(baseDir);
                        return;
                    }
                    
                    // 递归删除目录的函数（同步版本）
                    function deleteDirectorySync(dirPath) {
                        const files = fs.readdirSync(dirPath);
                        
                        for (const file of files) {
                            const fullPath = path.join(dirPath, file);
                            const stats = fs.statSync(fullPath);
                            
                            if (stats.isDirectory()) {
                                // 递归删除子目录
                                deleteDirectorySync(fullPath);
                                log(`✅ 删除子目录: ${fullPath}`, 'success', 'page6');
                            } else {
                                // 删除文件
                                fs.unlinkSync(fullPath);
                                log(`✅ 删除文件: ${fullPath}`, 'success', 'page6');
                            }
                        }
                        
                        // 删除空目录
                        fs.rmdirSync(dirPath);
                    }
                    
                    // 执行同步删除
                    deleteDirectorySync(testSubDir);
                    
                    log(`✅ 清理测试目录成功: ${testSubDir}`, 'success', 'page6');
                    const resultDiv = document.getElementById('dirTestResult');
                    resultDiv.innerHTML = `✅ 清理测试目录成功!<br>目录: ${testSubDir}`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    updateDirContents(baseDir);
                    
                } catch (error) {
                    log(`❌ 清理目录测试异常: ${error.message}`, 'error', 'page6');
                    const resultDiv = document.getElementById('dirTestResult');
                    resultDiv.innerHTML = `❌ 清理目录测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // ================ 错误处理测试的其他函数 ================
            
            // 测试读取不存在的文件
            function testNonexistentFile() {
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const nonExistentFile = path.join('/nonexistent', 'path', 'to', 'file.txt');
                    log(`测试读取不存在的文件: ${nonExistentFile}`, 'info', 'page7');
                    
                    // 同步方式测试
                    try {
                        fs.readFileSync(nonExistentFile, 'utf-8');
                        log(`❌ 应该抛出错误但没有抛出`, 'error', 'page7');
                        const resultDiv = document.getElementById('errorTestResult');
                        resultDiv.innerHTML = `❌ 同步读取不存在的文件应该抛出错误但没有抛出`;
                        resultDiv.style.backgroundColor = '#f8d7da';
                    } catch (syncErr) {
                        log(`✅ 同步读取捕获到错误: ${syncErr.message}`, 'success', 'page7');
                        log(`错误码: ${syncErr.code || '无'}`, 'info', 'page7');
                        
                        // 异步方式测试
                        fs.readFile(nonExistentFile, 'utf-8', function(asyncErr, data) {
                            if (asyncErr) {
                                log(`✅ 异步读取捕获到错误: ${asyncErr.message}`, 'success', 'page7');
                                log(`异步错误码: ${asyncErr.code || '无'}`, 'info', 'page7');
                                
                                const resultDiv = document.getElementById('errorTestResult');
                                resultDiv.innerHTML = `✅ 错误处理测试成功!<br>同步错误: ${syncErr.message}<br>异步错误: ${asyncErr.message}<br>错误码: ${syncErr.code || '无'}`;
                                resultDiv.style.backgroundColor = '#d4edda';
                            } else {
                                log(`❌ 异步读取应该抛出错误但没有抛出`, 'error', 'page7');
                                const resultDiv = document.getElementById('errorTestResult');
                                resultDiv.innerHTML = `❌ 异步读取不存在的文件应该抛出错误但没有抛出`;
                                resultDiv.style.backgroundColor = '#f8d7da';
                            }
                        });
                    }
                    
                } catch (error) {
                    log(`❌ 测试读取不存在的文件异常: ${error.message}`, 'error', 'page7');
                    const resultDiv = document.getElementById('errorTestResult');
                    resultDiv.innerHTML = `❌ 测试读取不存在的文件异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 测试无效路径
            function testInvalidPath() {
                try {
                    const fs = require('fs');
                    
                    log('测试无效路径参数', 'info', 'page7');
                    
                    // 测试 null 路径
                    try {
                        fs.readFileSync(null, 'utf-8');
                        log(`❌ null路径应该抛出错误但没有抛出`, 'error', 'page7');
                    } catch (nullErr) {
                        log(`✅ null路径捕获到错误: ${nullErr.message}`, 'success', 'page7');
                    }
                    
                    // 测试 undefined 路径
                    try {
                        fs.readFileSync(undefined, 'utf-8');
                        log(`❌ undefined路径应该抛出错误但没有抛出`, 'error', 'page7');
                    } catch (undefinedErr) {
                        log(`✅ undefined路径捕获到错误: ${undefinedErr.message}`, 'success', 'page7');
                    }
                    
                    // 测试空字符串路径
                    try {
                        fs.readFileSync('', 'utf-8');
                        log(`❌ 空字符串路径应该抛出错误但没有抛出`, 'error', 'page7');
                    } catch (emptyErr) {
                        log(`✅ 空字符串路径捕获到错误: ${emptyErr.message}`, 'success', 'page7');
                    }
                    
                    // 测试非字符串路径
                    try {
                        fs.readFileSync(123, 'utf-8');
                        log(`❌ 数字路径应该抛出错误但没有抛出`, 'error', 'page7');
                    } catch (numberErr) {
                        log(`✅ 数字路径捕获到错误: ${numberErr.message}`, 'success', 'page7');
                    }
                    
                    const resultDiv = document.getElementById('errorTestResult');
                    resultDiv.innerHTML = `✅ 无效路径测试完成<br>测试了null、undefined、空字符串和非字符串路径`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    
                } catch (error) {
                    log(`❌ 无效路径测试异常: ${error.message}`, 'error', 'page7');
                    const resultDiv = document.getElementById('errorTestResult');
                    resultDiv.innerHTML = `❌ 无效路径测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // 测试不存在的模块
            function testNonexistentModule() {
                try {
                    log('测试加载不存在的模块', 'info', 'page7');
                    
                    // 测试不存在的核心模块
                    try {
                        require('nonexistent_core_module');
                        log(`❌ 应该抛出模块不存在错误但没有抛出`, 'error', 'page7');
                    } catch (coreModuleErr) {
                        log(`✅ 捕获到核心模块不存在错误: ${coreModuleErr.message}`, 'success', 'page7');
                        log(`错误码: ${coreModuleErr.code || '无'}`, 'info', 'page7');
                    }
                    
                    // 测试不存在的文件模块
                    try {
                        require('./nonexistent_file.js');
                        log(`❌ 应该抛出文件模块不存在错误但没有抛出`, 'error', 'page7');
                    } catch (fileModuleErr) {
                        log(`✅ 捕获到文件模块不存在错误: ${fileModuleErr.message}`, 'success', 'page7');
                    }
                    
                    // 测试不存在的相对路径模块
                    try {
                        require('../nonexistent/relative/path');
                        log(`❌ 应该抛出相对路径模块不存在错误但没有抛出`, 'error', 'page7');
                    } catch (relativeModuleErr) {
                        log(`✅ 捕获到相对路径模块不存在错误: ${relativeModuleErr.message}`, 'success', 'page7');
                    }
                    
                    const resultDiv = document.getElementById('errorTestResult');
                    resultDiv.innerHTML = `✅ 不存在模块测试完成<br>测试了不存在的核心模块、文件模块和相对路径模块`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    
                } catch (error) {
                    log(`❌ 不存在模块测试异常: ${error.message}`, 'error', 'page7');
                    const resultDiv = document.getElementById('errorTestResult');
                    resultDiv.innerHTML = `❌ 不存在模块测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                }
            }
            
            // ================ 目录操作测试 ================
            function testDirectoryOperations() {
                log('开始测试目录操作...', 'info', 'page6');
                const resultDiv = document.getElementById('dirTestResult');
                resultDiv.innerHTML = '测试中...';
                resultDiv.style.backgroundColor = '#fff3cd';
                
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    const baseDir = document.getElementById('baseTestDir').value;
                    const subDirName = document.getElementById('testSubDir').value;
                    const testSubDir = path.join(baseDir, subDirName);
                    const testSubDir2 = path.join(testSubDir, 'nested');
                    
                    log(`测试目录: ${baseDir}`, 'info', 'page6');
                    log(`测试子目录: ${testSubDir}`, 'info', 'page6');
                    log(`测试嵌套目录: ${testSubDir2}`, 'info', 'page6');
                    
                    // 创建嵌套目录
                    fs.mkdirSync(testSubDir2, { recursive: true });
                    log(`✓ 创建目录: ${testSubDir2}`, 'success', 'page6');
                    
                    // 在目录中创建文件
                    const file1 = path.join(testSubDir2, 'file1.txt');
                    const file2 = path.join(testSubDir2, 'file2.txt');
                    
                    fs.writeFileSync(file1, '文件1内容', 'utf-8');
                    fs.writeFileSync(file2, '文件2内容', 'utf-8');
                    log(`✓ 在目录中创建文件: ${file1}, ${file2}`, 'success', 'page6');
                    
                    // 读取目录内容
                    const files = fs.readdirSync(testSubDir2);
                    log(`✓ 目录内容: ${files.join(', ')}`, 'success', 'page6');
                    
                    // 检查目录存在
                    const dirExists = fs.existsSync(testSubDir2);
                    const isDirectory = fs.statSync(testSubDir2).isDirectory();
                    
                    log(`✓ 目录存在检查: ${dirExists}`, 'success', 'page6');
                    log(`✓ 是否为目录检查: ${isDirectory}`, 'success', 'page6');
                    
                    // 显示目录内容
                    const dirContentsDiv = document.getElementById('dirContents');
                    dirContentsDiv.innerHTML = `
                        <div style="font-family: monospace;">
                            <div>目录路径: ${testSubDir2}</div>
                            <div>文件列表:</div>
                            <ul>
                                ${files.map(file => `<li>${file}</li>`).join('')}
                            </ul>
                            <div>目录存在: ${dirExists ? '是' : '否'}</div>
                            <div>是否为目录: ${isDirectory ? '是' : '否'}</div>
                        </div>
                    `;
                    
                    resultDiv.innerHTML = `✅ 目录操作测试成功!<br>
                        创建目录: ${testSubDir2}<br>
                        目录内容: ${files.length} 个文件<br>
                        目录存在: ${dirExists ? '是' : '否'}<br>
                        是否为目录: ${isDirectory ? '是' : '否'}`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    addTestResult(true);
                    
                } catch (error) {
                    resultDiv.innerHTML = `❌ 目录操作测试失败: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                    log(`错误: ${error.message}`, 'error', 'page6');
                    addTestResult(false);
                }
            }
            
            // ================ 错误处理测试 ================
            function testErrorHandling() {
                log('开始测试错误处理...', 'info', 'page7');
                const resultDiv = document.getElementById('errorTestResult');
                resultDiv.innerHTML = '测试中...';
                resultDiv.style.backgroundColor = '#fff3cd';
                
                try {
                    const fs = require('fs');
                    const path = require('path');
                    
                    // 测试读取不存在的文件
                    const nonExistentFile = path.join('/nonexistent', 'path', 'file.txt');
                    log(`测试读取不存在的文件: ${nonExistentFile}`, 'info', 'page7');
                    
                    let caughtError = false;
                    let errorMessage = '';
                    try {
                        fs.readFileSync(nonExistentFile, 'utf-8');
                    } catch (error) {
                        caughtError = true;
                        errorMessage = error.message;
                        log(`✓ 成功捕获错误: ${error.message}`, 'success', 'page7');
                        
                        // 检查错误码
                        if (error.code === 'ENOENT') {
                            log(`✓ 错误码正确: ENOENT`, 'success', 'page7');
                        } else {
                            log(`警告: 错误码不是 ENOENT，而是: ${error.code}`, 'warning', 'page7');
                        }
                    }
                    
                    if (!caughtError) {
                        resultDiv.innerHTML = '❌ 应该抛出错误但没有抛出';
                        resultDiv.style.backgroundColor = '#f8d7da';
                        log('错误: 应该抛出错误但没有抛出', 'error', 'page7');
                        addTestResult(false);
                        return;
                    }
                    
                    // 测试 require 不存在的模块
                    log('测试 require 不存在的模块...', 'info', 'page7');
                    let moduleErrorCaught = false;
                    try {
                        require('nonexistent_module');
                    } catch (error) {
                        moduleErrorCaught = true;
                        log(`✓ 成功捕获模块不存在错误: ${error.message}`, 'success', 'page7');
                        
                        if (error.code === 'MODULE_NOT_FOUND') {
                            log(`✓ 模块错误码正确: MODULE_NOT_FOUND`, 'success', 'page7');
                        }
                    }
                    
                    if (!moduleErrorCaught) {
                        resultDiv.innerHTML = '❌ 应该抛出模块不存在错误但没有抛出';
                        resultDiv.style.backgroundColor = '#f8d7da';
                        log('错误: 应该抛出模块不存在错误但没有抛出', 'error', 'page7');
                        addTestResult(false);
                        return;
                    }
                    
                    resultDiv.innerHTML = `✅ 错误处理测试成功!<br>
                        文件不存在错误: ${errorMessage}<br>
                        模块不存在错误: 正确捕获`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    log('错误处理测试完成', 'success', 'page7');
                    addTestResult(true);
                    
                } catch (error) {
                    resultDiv.innerHTML = `❌ 错误处理测试异常: ${error.message}`;
                    resultDiv.style.backgroundColor = '#f8d7da';
                    log(`异常: ${error.message}`, 'error', 'page7');
                    addTestResult(false);
                }
            }
            
            // ================ 综合测试 ================
            async function runAllTests() {
                if (testRunning) {
                    log('测试已在运行中', 'warning', 'page8');
                    return;
                }
                
                testRunning = true;
                resetTestStats();
                
                const resultDiv = document.getElementById('allTestResult');
                resultDiv.innerHTML = '全面测试开始...';
                resultDiv.style.backgroundColor = '#fff3cd';
                
                log('开始全面测试...', 'info', 'page8');
                
                // 切换到第8页
                goToPage(8);
                
                // 模拟测试序列
                const tests = [
                    { name: '模块加载测试', func: testModuleLoading, page: 2 },
                    { name: 'path 模块测试', func: testPathModule, page: 3 },
                    { name: 'fs 同步操作测试', func: testFileOperations, page: 4 },
                    { name: 'fs 异步操作测试', func: testAsyncFileOperations, page: 5 },
                    { name: '目录操作测试', func: testDirectoryOperations, page: 6 },
                    { name: '错误处理测试', func: testErrorHandling, page: 7 }
                ];
                
                for (let i = 0; i < tests.length; i++) {
                    if (!testRunning) break;
                    
                    const test = tests[i];
                    log(`运行测试 ${i + 1}/${tests.length}: ${test.name}`, 'info', 'page8');
                    
                    // 模拟测试执行
                    await new Promise(resolve => {
                        setTimeout(() => {
                            // 这里应该调用实际的测试函数
                            // 为了演示，我们模拟一个随机结果
                            const success = Math.random() > 0.3;
                            if (success) {
                                log(`✓ ${test.name} 通过`, 'success', 'page8');
                                addTestResult(true);
                            } else {
                                log(`❌ ${test.name} 失败`, 'error', 'page8');
                                addTestResult(false);
                            }
                            resolve();
                        }, 1000);
                    });
                }
                
                const successRate = testResults.total > 0 ? 
                    Math.round((testResults.passed / testResults.total) * 100) : 0;
                
                if (testResults.failed === 0) {
                    resultDiv.innerHTML = `✅ 所有测试完成!<br>
                        通过: ${testResults.passed}/${testResults.total} 个测试<br>
                        成功率: ${successRate}%<br>
                        所有测试都通过!`;
                    resultDiv.style.backgroundColor = '#d4edda';
                    log('所有测试都通过!', 'success', 'page8');
                } else {
                    resultDiv.innerHTML = `⚠️ 测试完成，但有失败项<br>
                        通过: ${testResults.passed}/${testResults.total} 个测试<br>
                        失败: ${testResults.failed} 个测试<br>
                        成功率: ${successRate}%`;
                    resultDiv.style.backgroundColor = '#fff3cd';
                    log(`测试完成，${testResults.failed} 个测试失败`, 'warning', 'page8');
                }
                
                testRunning = false;
                updateGlobalStatus(`全面测试完成: ${testResults.passed}/${testResults.total} 通过`);
            }
            
            function stopTests() {
                testRunning = false;
                log('测试已停止', 'warning', 'page8');
            }
            
            // ================ 页面初始化 ================
            function initializePage() {
                // 恢复上次查看的页面
                const lastPage = localStorage.getItem('lastPage');
                if (lastPage) {
                    currentPage = parseInt(lastPage);
                }
                
                updateNavigation();
                updateGlobalStatus('系统已就绪');
                
                // 初始环境检查
                setTimeout(() => {
                    checkEnvironment();
                }, 1000);
                
                log('页面初始化完成', 'success');
            }
            
            // 页面加载完成后初始化
            window.onload = initializePage;
        </script>
    </body>
</html>